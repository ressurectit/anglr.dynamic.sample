"use strict";(self.webpackChunkng_universal_demo=self.webpackChunkng_universal_demo||[]).push([[9444],{12125:(t,e,n)=>{n.d(e,{M:()=>y});var i=n(81267),o=n(34955),s=n(78072),a=n(69445),r=n(74957),l=n(52205),u=n(37654),c=n(66382),d=n(47948),h=n(13341),p=n(5062),m=n(27805),g=n(1944),f=n(92927);class y{constructor(t,e){this.changeDetector=t,this.element=e,this.history=(0,i.f3)(l.nR),this.initialized=!1,this.isDragging=!1,this.moved=!1,this.lastMouseDownPosition={x:0,y:0},this.lastMouseDownNodePosition={x:0,y:0},this.nodePosition={x:0,y:0},this.ɵAllOutputs=[],this.ɵInputs={},this.ɵOutputs={},this.destroySubject=new s.x,this.zoomLevel=1,this.element.nativeElement.classList.add("relations-node"),this.updatePosition(),this.observer=new ResizeObserver((()=>this.updateRelations())),this.observer.observe(this.element.nativeElement)}get id(){return this.metadata?.id??""}get allOutputs(){return this.ɵAllOutputs}get inputs(){return this.ɵInputs}get outputs(){return this.ɵOutputs}get destroy(){return this.destroySubject.asObservable()}ngOnChanges(t){(0,o.$)("metadata")in t&&this.metadata&&(this.metadata.nodeMetadata?.coordinates&&(this.nodePosition=this.metadata.nodeMetadata.coordinates,this.updatePosition()),this.metadataSet())}ngOnDestroy(){this.observer?.disconnect()}invalidateVisuals(){this.changeDetector.detectChanges(),this.initialized||(this.initialized=!0,this.initEndpoints())}initialize(){}onMouseDown(t){this.moved=!1,this.isDragging=!0,this.lastMouseDownPosition={x:t.clientX,y:t.clientY},this.lastMouseDownNodePosition={x:this.nodePosition.x,y:this.nodePosition.y},t.stopImmediatePropagation()}onMouseMove(t){this.isDragging&&(this.moved=!0,this.nodePosition={x:this.lastMouseDownNodePosition.x+1*(t.clientX-this.lastMouseDownPosition.x)/this.zoomLevel,y:this.lastMouseDownNodePosition.y+1*(t.clientY-this.lastMouseDownPosition.y)/this.zoomLevel},this.updatePosition(),t.stopImmediatePropagation(),t.preventDefault(),this.updateRelations())}onMouseUp(t){this.isDragging&&(this.moved&&this.history.getNewState(),this.isDragging=!1,t.stopImmediatePropagation(),t.preventDefault())}initEndpoints(){const t=()=>{this.ɵInputs={},this.inputsChildren?.forEach((t=>{t.name&&(this.ɵInputs[t.name]=t)})),Object.freeze(this.ɵInputs)},e=()=>{this.ɵAllOutputs=this.outputsChildren.toArray(),this.ɵOutputs={},this.outputsChildren?.forEach((t=>{t.name&&(this.ɵOutputs[t.name]=t)})),Object.freeze(this.ɵOutputs)};this.inputsChildren?.changes.subscribe((()=>t())),this.outputsChildren?.changes.subscribe((()=>e())),t(),e()}updateRelations(){this.inputsChildren.forEach((t=>{t.updateRelation()})),this.outputsChildren.forEach((t=>{t.updateRelation()}))}updatePosition(){this.element.nativeElement.style.left=`${this.nodePosition.x}px`,this.element.nativeElement.style.top=`${this.nodePosition.y}px`,this.metadata?.nodeMetadata?.coordinates&&(this.metadata.nodeMetadata.coordinates.x=this.nodePosition.x,this.metadata.nodeMetadata.coordinates.y=this.nodePosition.y)}metadataSet(){}}y.ɵfac=function(t){return new(t||y)(u.Y(c.s),u.Y(d.SB))},y.ɵdir=h.lG({type:y,viewQuery:function(t,e){if(1&t&&(p.Gf(r.P,5),p.Gf(a.n,5)),2&t){let t;p.iG(t=p.CR())&&(e.inputsChildren=t),p.iG(t=p.CR())&&(e.outputsChildren=t)}},hostBindings:function(t,e){1&t&&m.N("mousedown",(function(t){return e.onMouseDown(t)}))("mousemove",(function(t){return e.onMouseMove(t)}),!1,g.Jf)("mouseup",(function(t){return e.onMouseUp(t)}),!1,g.Jf)},features:[f.T]})},79405:(t,e,n)=>{n.d(e,{S:()=>u});var i=n(37654),o=n(47948),s=n(13341),a=n(41169),r=n(82875),l=n(16498);class u{constructor(t,e,n){this._element=t,this._relationManager=e,this._canvas=n,this._isDragging=!1,this._isHighlighted=!1,this._lastMouseDownPosition={x:0,y:0},this.zoomLevel=1,this.parentCoordiantes={x:0,y:0}}get parentId(){return this.parent?.id??""}ngOnInit(){if(!this.parent)throw new Error("Every input or output endpoint must have parent specified")}getCoordinates(){return{x:this.parentCoordiantes.x+this._element.nativeElement.offsetLeft+this._element.nativeElement.offsetWidth/2,y:this.parentCoordiantes.y+this._element.nativeElement.offsetTop+this._element.nativeElement.offsetHeight/2}}highlight(){this._isHighlighted=!0}cancelHighlight(){this._isHighlighted=!1}}u.ɵfac=function(t){return new(t||u)(i.Y(o.SB),i.Y(r.J),i.Y(l.F))},u.ɵdir=s.lG({type:u,hostVars:2,hostBindings:function(t,e){2&t&&a.ek("highlighted",e._isHighlighted)},inputs:{name:"name",zoomLevel:"zoomLevel",parentCoordiantes:"parentCoordiantes",parent:"parent"}})},32123:(t,e,n)=>{n.d(e,{e:()=>$});var i=n(12405),o=n(49392),s=n(89033),a=n(8423),r=n(47826),l=n(65540),u=n(74062),c=n(13816);class d{constructor(t){this.displayName=null,this.scope=null,c.Rl.bind(this)(t)}}var h=n(12890),p=n(5419),m=n(50478),g=n(28588),f=n(4149),y=n(83210),_=n(52455),v=n(37654),M=n(13341),D=n(18968),b=n(94128),x=n(15704),w=n(97503),P=n(78525),C=n(77549),R=n(57684),I=n(86039),E=n(58433),O=n(49308),N=n(48215);function Y(t,e){1&t&&h._U(0,"input",8),2&t&&p.Q("readonly",!0)}function z(t,e){if(1&t&&(h.Tg(0,"option",12),m._(1),h.qZ()),2&t){const t=e.$implicit;p.Q("value",t),g.x(1),f.Oq(t)}}function L(t,e){if(1&t&&(h.Tg(0,"select",9)(1,"option",10),m._(2,"---"),h.qZ(),y.Y(3,z,2,2,"option",11),h.qZ()),2&t){const t=_.o();g.x(3),p.Q("ngForOf",t.scopes)}}class q{constructor(t,e){this.data=t,this.scopes=[],this.form=e.build(new d(t.properties)),this.scopes=t.scopeRegister.scopes}}q.ɵfac=function(t){return new(t||q)(v.Y(l.m),v.Y(u.p))},q.ɵcmp=M.Xp({type:q,selectors:[["relations-node-properties-editor"]],standalone:!0,features:[D._([u.p]),b.j],decls:15,vars:5,consts:[[1,"dynamic-form-group",3,"formGroup"],[1,"dynamic-control-label"],["type","text","formControlName","displayName",1,"dynamic-form-control"],["class","dynamic-form-control","type","text","formControlName","scope",3,"readonly",4,"ngIf"],["class","dynamic-form-control","formControlName","scope",4,"ngIf"],[1,"dynamic-flex-row","dynamic-flex-end","dynamic-margin-top-small"],["type","button",1,"dynamic-btn","dynamic-btn-info","dynamic-margin-right-extra-small",3,"mat-dialog-close"],["type","button",1,"dynamic-btn","dynamic-btn-primary",3,"mat-dialog-close"],["type","text","formControlName","scope",1,"dynamic-form-control",3,"readonly"],["formControlName","scope",1,"dynamic-form-control"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,e){1&t&&(h.Tg(0,"div",0)(1,"label",1),m._(2,"display name"),h.qZ(),h._U(3,"input",2),h.Tg(4,"label",1),m._(5,"scope"),h.qZ(),y.Y(6,Y,1,1,"input",3),y.Y(7,L,4,1,"select",4),h.qZ(),h.Tg(8,"div",5)(9,"button",6)(10,"span"),m._(11,"cancel"),h.qZ()(),h.Tg(12,"button",7)(13,"span"),m._(14,"ok"),h.qZ()()()),2&t&&(p.Q("formGroup",e.form),g.x(6),p.Q("ngIf",!e.data.scopeConfigurable),g.x(1),p.Q("ngIf",e.data.scopeConfigurable),g.x(2),p.Q("mat-dialog-close",null),g.x(3),p.Q("mat-dialog-close",e.form.value))},dependencies:[i.e,x.sg,w.O,r.I,P.ZT,a.U,C.YN,R.Kr,I.Fj,C.EJ,E.JJ,E.JL,O.s,N.u],encapsulation:2,changeDetection:0});var S=n(2860);class T{transform(t){return t?(0,S.Wg)(t):null}}T.ɵfac=function(t){return new(t||T)},T.ɵpipe=M.Yj({name:"toColor",type:T,pure:!0,standalone:!0});var j=n(52205),Z=n(87859),J=n(41169),Q=n(38256),U=n(27805),k=n(63289),X=n(66382),H=n(81473),G=n(26727),V=n(94035);function A(t,e,n,i,o,s,a){try{var r=t[s](a),l=r.value}catch(t){return void n(t)}r.done?e(l):Promise.resolve(l).then(i,o)}function F(t,e){if(1&t&&(h.Tg(0,"span",5),Z.AL(1,"toColor"),m._(2,"{}"),h.qZ()),2&t){const t=_.o();J.Ud("color",Z.lc(1,3,null==t.parent||null==t.parent.metadata?null:t.parent.metadata.scope)),p.Q("tooltip",null==t.parent||null==t.parent.metadata?null:t.parent.metadata.scope)}}function B(t,e){if(1&t){const t=Q.E();h.Tg(0,"button",6),U.N("click",(function(){k.CH(t);const e=_.o();return k.Kt(e.destroySubject.next())})),h._U(1,"span",7),h.qZ()}}class ${constructor(t,e,n,i){this.dialog=t,this.changeDetector=e,this.scopeRegister=n,this.history=i}editProperties(){var t,e=this;return(t=function*(){const t=yield(0,s.n)(e.dialog.open(q,{title:"edit properties",width:"30vw",data:{properties:{displayName:e.parent?.metadata?.displayName||e.name||e.parent?.metadata?.id||"",scope:e.parent?.metadata?.scope??""},scopeConfigurable:e.parent?.metadata?.nodeMetadata?.scopeConfigurable??!1,scopeRegister:e.scopeRegister}}).afterClosed());t&&e.parent?.metadata&&(e.parent.metadata.displayName=t.displayName??void 0,e.parent.metadata.scope=t.scope??void 0,e.history.getNewState(),e.changeDetector.detectChanges())},function(){var e=this,n=arguments;return new Promise((function(i,o){var s=t.apply(e,n);function a(t){A(s,i,o,a,r,"next",t)}function r(t){A(s,i,o,a,r,"throw",t)}a(void 0)}))})()}}$.ɵfac=function(t){return new(t||$)(v.Y(H.J),v.Y(X.s),v.Y(G.a),v.Y(j.nR))},$.ɵcmp=M.Xp({type:$,selectors:[["relations-node-header"]],inputs:{parent:"parent",destroySubject:"destroySubject",name:"name"},standalone:!0,features:[b.j],decls:6,vars:3,consts:[[1,"header-content"],["class","dynamic-margin-horizontal-extra-small dynamic-bold",3,"tooltip","color",4,"ngIf"],["type","button",1,"dynamic-btn-icon","edit-icon",3,"click"],[1,"fas","fa-pen"],["type","button","class","dynamic-btn-icon destroy-icon",3,"click",4,"ngIf"],[1,"dynamic-margin-horizontal-extra-small","dynamic-bold",3,"tooltip"],["type","button",1,"dynamic-btn-icon","destroy-icon",3,"click"],[1,"fas","fa-times"]],template:function(t,e){1&t&&(h.Tg(0,"div",0),m._(1),h.qZ(),y.Y(2,F,3,5,"span",1),h.Tg(3,"button",2),U.N("click",(function(){return e.editProperties()})),h._U(4,"span",3),h.qZ(),y.Y(5,B,2,0,"button",4)),2&t&&(g.x(1),f.Oq((null==e.parent||null==e.parent.metadata?null:e.parent.metadata.displayName)||e.name||(null==e.parent||null==e.parent.metadata?null:e.parent.metadata.id)),g.x(1),p.Q("ngIf",null==e.parent||null==e.parent.metadata?null:e.parent.metadata.scope),g.x(3),p.Q("ngIf",e.destroySubject))},dependencies:[i.e,w.O,o.z,V.i,T],encapsulation:2,changeDetection:0})},74957:(t,e,n)=>{n.d(e,{P:()=>p});var i=n(12405),o=n(79405),s=n(66510),a=n(61247),r=n(46936),l=n(13341),u=n(27805),c=n(1944),d=n(52900),h=n(94128);class p extends o.S{ngOnDestroy(){this._relation&&this._relation.destroy()}addRelation(t){if(this._relation){if(this._relation.start?.x===t.start?.x&&this._relation.start?.y===t.start?.y)return!1;this._relation.destroy()}return this._relation=t,!0}endRelation(t){this.addRelation(t)&&this.updateRelation()}updateRelation(){this._relation&&(this._relation.end=this.getCoordinates(),this._relation.input=this,this._relation.invalidateVisuals())}_onMouseEnter(t){t.buttons===s.t.LEFT&&this._relationManager.setActiveInput(this),this._relation?.highlight()}_onMouseLeave(t){t.buttons===s.t.LEFT&&this._relationManager.setActiveInput(null),this._relation?.cancelHighlight()}_onMouseDown(t){t.stopImmediatePropagation(),t.preventDefault(),this._lastMouseDownPosition={x:t.clientX,y:t.clientY},this._tempRelation=this._relation,this._relation=null,this._isDragging=!0}_onMouseMove(t){this._isDragging&&(t.stopImmediatePropagation(),t.preventDefault(),this._tempRelation&&(this._tempRelation.end={x:this.getCoordinates().x+1*(t.clientX-this._lastMouseDownPosition?.x)/this.zoomLevel,y:this.getCoordinates().y+1*(t.clientY-this._lastMouseDownPosition?.y)/this.zoomLevel},this._tempRelation.invalidateVisuals()))}_onMouseUp(t){this._isDragging&&(this._isDragging=!1,t.stopImmediatePropagation(),t.preventDefault(),this._tempRelation?.invalidateVisuals(a.r))}}p.ɵfac=function(){let t;return function(e){return(t||(t=r.n5(p)))(e||p)}}(),p.ɵcmp=l.Xp({type:p,selectors:[["relation-node-input"]],hostBindings:function(t,e){1&t&&u.N("mouseenter",(function(t){return e._onMouseEnter(t)}))("mouseleave",(function(t){return e._onMouseLeave(t)}))("mousedown",(function(t){return e._onMouseDown(t)}))("mousemove",(function(t){return e._onMouseMove(t)}),!1,c.Jf)("mouseup",(function(t){return e._onMouseUp(t)}),!1,c.Jf)},standalone:!0,features:[d.q,h.j],decls:0,vars:0,template:function(t,e){},dependencies:[i.e],encapsulation:2,changeDetection:0})},69445:(t,e,n)=>{n.d(e,{n:()=>h});var i=n(12405),o=n(79405),s=n(61247),a=n(46936),r=n(13341),l=n(27805),u=n(1944),c=n(52900),d=n(94128);class h extends o.S{constructor(){super(...arguments),this._relations=[]}get relations(){return this._relations}ngOnDestroy(){if(this._relations){const t=[...this._relations];for(const e of t)e.destroy()}}startRelation(){const t=this._canvas.createRelation();return t.start=this.getCoordinates(),t.output=this,t.destroying.subscribe((()=>{const e=this._relations.indexOf(t);e>=0&&this._relations.splice(e,1)})),this._relations.push(t),t}updateRelation(){if(this._relations)for(const t of this._relations)t.start=this.getCoordinates(),t.invalidateVisuals()}_onMouseDown(t){t.stopImmediatePropagation(),t.preventDefault(),this._isDragging=!0,this._lastMouseDownPosition={x:t.clientX,y:t.clientY},this._relation=this.startRelation()}_onMouseEnter(t){this._relations?.forEach((t=>t?.highlight()))}_onMouseLeave(t){this._relations?.forEach((t=>t?.cancelHighlight()))}_onMouseMove(t){this._isDragging&&(t.stopImmediatePropagation(),t.preventDefault(),this._relation&&(this._relation.end={x:this.getCoordinates().x+1*(t.clientX-this._lastMouseDownPosition.x)/this.zoomLevel,y:this.getCoordinates().y+1*(t.clientY-this._lastMouseDownPosition.y)/this.zoomLevel},this._relation.invalidateVisuals()))}_onMouseUp(t){this._isDragging&&(this._isDragging=!1,t.stopImmediatePropagation(),t.preventDefault(),this._relation?.invalidateVisuals(s.r))}}h.ɵfac=function(){let t;return function(e){return(t||(t=a.n5(h)))(e||h)}}(),h.ɵcmp=r.Xp({type:h,selectors:[["relation-node-output"]],hostBindings:function(t,e){1&t&&l.N("mousedown",(function(t){return e._onMouseDown(t)}))("mouseenter",(function(t){return e._onMouseEnter(t)}))("mouseleave",(function(t){return e._onMouseLeave(t)}))("mousemove",(function(t){return e._onMouseMove(t)}),!1,u.Jf)("mouseup",(function(t){return e._onMouseUp(t)}),!1,u.Jf)},standalone:!0,features:[c.q,d.j],decls:0,vars:0,template:function(t,e){},dependencies:[i.e],encapsulation:2,changeDetection:0})}}]);
//# sourceMappingURL=9444.client.chunk.12f7df6026c84709c208.js.map